var metafield,metafieldSortable;(function(e){metafield={add_postbox_toggles:function(t,n){var r=this;r.init(t,n);e(".meta-field-box h3, .meta-field-box .handlediv").bind("click.metafield",function(){var n=e(this).parent(".meta-field-box"),i=n.attr("id");if("dashboard_browser_nag"==i)return;n.toggleClass("closed");if(t!="press-this")r.save_state(t);if(i){if(!n.hasClass("closed")&&e.isFunction(metafield.pbshow))r.pbshow(i);else if(n.hasClass("closed")&&e.isFunction(metafield.pbhide))r.pbhide(i)}});e(".meta-field-box h3 a").click(function(e){e.stopPropagation()});e(".meta-field-box a.dismiss").bind("click.metafield",function(t){var n=e(this).parents(".meta-field-box").attr("id")+"-hide";e("#"+n).prop("checked",false).triggerHandler("click");return false});e(".hide-postbox-tog").bind("click.metafield",function(){var n=e(this).val();if(e(this).prop("checked")){e("#"+n).show();if(e.isFunction(metafield.pbshow))r.pbshow(n)}else{e("#"+n).hide();if(e.isFunction(metafield.pbhide))r.pbhide(n)}r.save_state(t);r._mark_area()});e('.columns-prefs input[type="radio"]').bind("click.metafield",function(){var n=parseInt(e(this).val(),10);if(n){r._pb_edit(n);r.save_order(t)}})},init:function(t,n){var r=e(document.body).hasClass("mobile");e.extend(this,n||{});e("#wpbody-content").css("overflow","hidden");metafieldSortable=e(".meta-field-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-field-sortables",items:".meta-field-box, .meta-field-system-box",handle:".meta-field-hndle",cursor:"move",delay:r?200:0,distance:2,tolerance:"pointer",forcePlaceholderSize:true,helper:"clone",opacity:.65,start:function(t,n){if(e("#ui_controls").length>0){jtabs.activate(0)}},stop:function(n,r){if(e(this).find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=this.firstChild.id){e(this).sortable("cancel");return}metafield.save_order(t)},receive:function(t,n){if(e(n.item).parent().length>0){if(e(n.item).parent().attr("id")=="inactive-sortables"){e(n.item).addClass("closed")}else if(e(this).hasClass("tableoverview")!=true){}}if("dashboard_browser_nag"==n.item[0].id)e(n.sender).sortable("cancel");metafield._mark_area()}});if(r){e(document.body).bind("orientationchange.metafield",function(){metafield._pb_change()});this._pb_change()}this._mark_area()},save_state:function(t){var n=e(".meta-field-box").filter(".closed").map(function(){return this.id}).get().join(","),r=e(".meta-field-box").filter(":hidden").map(function(){return this.id}).get().join(",");e.post(ajaxurl,{action:"closed-metafield",closed:n,hidden:r,closedmetafieldnonce:jQuery("#closedmetafieldnonce").val(),page:t})},save_order:function(t){var n,r=e(".columns-prefs input:checked").val()||0;n={action:this.action,_ajax_nonce:e("#meta-box-field-nonce").val(),page_columns:r,page:t,post_type:this.post_type};e(".meta-field-sortables").each(function(){n["order["+this.id.split("-")[0]+"]"]=e(this).sortable("toArray").join(",")});if(this.action=="savetableoverview"){e.post(ajaxurl,n,function(e){setMessage(e)})}},_mark_area:function(){var t=e("div.meta-field-box:visible").length,n=e("#post-body #side-sortables");e("#dashboard-widgets .meta-field-sortables:visible").each(function(n,r){var i=e(this);if(t==1||i.children(".meta-field-box:visible").length)i.removeClass("empty-container");else i.addClass("empty-container")});if(n.length){if(n.children(".meta-field-box:visible").length)n.removeClass("empty-container");else if(e("#postbox-container-1").css("width")=="280px")n.addClass("empty-container")}},_pb_edit:function(t){var n=e(".metabox-holder").get(0);n.className=n.className.replace(/columns-\d+/,"columns-"+t)},_pb_change:function(){switch(window.orientation){case 90:case-90:this._pb_edit(2);break;case 0:case 180:if(e("#poststuff").length)this._pb_edit(1);else this._pb_edit(2);break}},pbshow:false,pbhide:false}})(jQuery)